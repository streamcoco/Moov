<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moov</title>
    <link rel="icon" type="image/ico" href="Portadas/iconnn.ico">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="login-body">

    <div class="center-wrapper">

        <div class="brand-logo-container">
            <img src="Portadas/login.png" alt="MOOV" class="brand-logo">
        </div>

        <div class="login-container" id="loginContainer">
            <div class="login-form-content">
                <form id="loginForm">
                    <input type="text" id="user" name="user" placeholder="USUARIO" required tabindex="1" autocomplete="off">
                    
                    <input type="password" id="pass" name="pass" placeholder="CONTRASEÑA" required tabindex="2">
                    
                    <button type="submit" id="loginBtn" tabindex="3">ENTRAR</button>
                    
                    <a href="#" 
                       onclick="window.open('https://mail.google.com/mail/?view=cm&fs=1&to=M00v.5tr34m@gmail.com&su=Solicitud%20de%20Cuenta%20MOOV&body=Hola%2C%20me%20gustar%C3%ADa%20solicitar%20un%20usuario%20para%20acceder%20a%20MOOV.', 'GmailPopup', 'width=600,height=600,scrollbars=yes,resizable=yes'); return false;"
                       id="requestBtn" 
                       class="request-button" 
                       tabindex="4">
                       SOLICITAR CUENTA
                    </a>

                    <p id="error-message" class="error-message"></p>
                </form>
            </div>
        </div>

    </div>

    <div class="logout-container" id="logoutContainer" style="display: none;">
        <button id="logoutButton" tabindex="0">Salir</button>
    </div>

    <iframe id="content"></iframe>

    <script>
        /* =========================================
           LÓGICA INTERNA DE LOGIN + NAVEGACIÓN
           ========================================= */

        const SEVEN_DAYS = 7 * 24 * 60 * 60 * 1000;
        
        const credentials = [
            { user: 'YW50b3RhcA==', pass: 'cGVvY2FjYTEyMw==' },
            { user: 'cGVsaXNmcmVl', pass: 'bGFwY293bXg=' },
            { user: 'YWRtaW5jb2Nv', pass: 'cG90YXNpbw==' },
            { user: 'bWFtYQ==', pass: 'a2lheWE=' }
        ];

        // NAVEGACIÓN (Control Remoto)
        document.addEventListener('keydown', function(e) {
            const active = document.activeElement;
            const userIn = document.getElementById('user');
            const passIn = document.getElementById('pass');
            const loginBtn = document.getElementById('loginBtn');
            const reqBtn = document.getElementById('requestBtn');

            // Flecha ABAJO (Código 40)
            if (e.keyCode === 40) { 
                e.preventDefault();
                if (active === userIn) passIn.focus();
                else if (active === passIn) loginBtn.focus();
                else if (active === loginBtn) reqBtn.focus(); 
            }
            // Flecha ARRIBA (Código 38)
            else if (e.keyCode === 38) {
                e.preventDefault();
                if (active === reqBtn) loginBtn.focus(); 
                else if (active === loginBtn) passIn.focus();
                else if (active === passIn) userIn.focus();
            }
            // Tecla ENTER en el botón de solicitar (para activar el popup con el mando)
            else if (e.keyCode === 13 && active === reqBtn) {
                reqBtn.click();
            }
        });

        function checkSession() {
            const serverLoginTime = localStorage.getItem('serverLoginTime');
            const currentUser = localStorage.getItem('currentUser');

            if (serverLoginTime && currentUser) {
                const elapsedTime = Date.now() - parseInt(serverLoginTime, 10);
                if (elapsedTime < SEVEN_DAYS) {
                    showContent();
                } else {
                    logout();
                }
            } else {
                setTimeout(() => document.getElementById('user').focus(), 500);
            }
        }

        function login(e) {
            e.preventDefault();
            const userInput = document.getElementById('user').value;
            const passInput = document.getElementById('pass').value;
            const errorMsg = document.getElementById('error-message');

            const isValid = credentials.some(cred => 
                userInput === atob(cred.user) && passInput === atob(cred.pass)
            );

            if (isValid) {
                localStorage.setItem('serverLoginTime', Date.now().toString());
                localStorage.setItem('currentUser', userInput);
                showContent();
            } else {
                errorMsg.textContent = 'Usuario o contraseña incorrectos.';
                document.getElementById('pass').value = ''; 
                document.getElementById('pass').focus();
            }
        }

        function showContent() {
            document.querySelector('.center-wrapper').style.display = 'none';
            document.getElementById('logoutContainer').style.display = 'block';
            document.body.classList.remove('login-body');
            document.body.style.backgroundColor = 'black';

            const contentFrame = document.getElementById('content');
            contentFrame.src = 'web.html'; 
            contentFrame.style.display = 'block';
            
            contentFrame.onload = function() {
                contentFrame.contentWindow.focus();
            };
        }

        function logout() {
            localStorage.removeItem('currentUser');
            localStorage.removeItem('serverLoginTime');
            location.reload(); 
        }

        document.addEventListener('DOMContentLoaded', checkSession);
        document.getElementById('loginForm').addEventListener('submit', login);
        document.getElementById('logoutButton').addEventListener('click', logout);
        document.addEventListener('contextmenu', e => e.preventDefault());

    </script>
</body>
</html>
