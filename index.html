<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disney - Acceso</title>
    <link rel="icon" type="image/ico" href="Portadas/icon.ico">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="login-body">

    <div class="logout-container" id="logoutContainer" style="display: none;">
        <button id="logoutButton" tabindex="0">Cerrar sesión</button>
    </div>

    <div class="login-container" id="loginContainer">
        <div class="login-form-content">
            <h2>INICIAR SESIÓN</h2>
            <form id="loginForm">
                <label for="user">USUARIO</label>
                <input type="text" id="user" name="user" required tabindex="1" autocomplete="off">
                
                <label for="pass">CONTRASEÑA</label>
                <input type="password" id="pass" name="pass" required tabindex="2">
                
                <button type="submit" id="loginBtn" tabindex="3">Entrar</button>
                
                <p id="error-message" class="error-message"></p>
            </form>
        </div>
    </div>

    <iframe id="content"></iframe>

    <script>
        /* =========================================
           LÓGICA INTERNA DE LOGIN (SOLO PARA INDEX)
           ========================================= */

        const SEVEN_DAYS = 7 * 24 * 60 * 60 * 1000;
        
        // TUS CREDENCIALES
        const credentials = [
            { user: 'YW50b3RhcA==', pass: 'cGVvY2FjYTEyMw==' },
            { user: 'cGVsaXNmcmVl', pass: 'bGFwY293bXg=' },
            { user: 'YWRtaW5jb2Nv', pass: 'cG90YXNpbw==' },
            { user: 'bWFtYQ==', pass: 'a2lheWE=' }
        ];

        // 1. CONTROL REMOTO EN LOGIN (Navegación Vertical)
        document.addEventListener('keydown', function(e) {
            const active = document.activeElement;
            const userIn = document.getElementById('user');
            const passIn = document.getElementById('pass');
            const btn = document.getElementById('loginBtn');

            // Flecha ABAJO
            if (e.keyCode === 40) { 
                if (active === userIn) { e.preventDefault(); passIn.focus(); }
                else if (active === passIn) { e.preventDefault(); btn.focus(); }
            }
            // Flecha ARRIBA
            else if (e.keyCode === 38) {
                if (active === btn) { e.preventDefault(); passIn.focus(); }
                else if (active === passIn) { e.preventDefault(); userIn.focus(); }
            }
        });

        // 2. VERIFICAR SESIÓN GUARDADA
        function checkSession() {
            const serverLoginTime = localStorage.getItem('serverLoginTime');
            const currentUser = localStorage.getItem('currentUser');

            if (serverLoginTime && currentUser) {
                const elapsedTime = Date.now() - parseInt(serverLoginTime, 10);
                if (elapsedTime < SEVEN_DAYS) {
                    showContent();
                } else {
                    logout();
                }
            } else {
                // Si no hay sesión, poner foco en usuario
                setTimeout(() => document.getElementById('user').focus(), 500);
            }
        }

        // 3. PROCESO DE LOGIN
        function login(e) {
            e.preventDefault();
            const userInput = document.getElementById('user').value;
            const passInput = document.getElementById('pass').value;
            const errorMsg = document.getElementById('error-message');

            const isValid = credentials.some(cred => 
                userInput === atob(cred.user) && passInput === atob(cred.pass)
            );

            if (isValid) {
                localStorage.setItem('serverLoginTime', Date.now().toString());
                localStorage.setItem('currentUser', userInput);
                showContent();
            } else {
                errorMsg.textContent = 'Usuario o contraseña incorrectos.';
                document.getElementById('pass').value = ''; 
                document.getElementById('pass').focus();
            }
        }

        // 4. MOSTRAR LA WEB (Ocultar Login)
        function showContent() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('logoutContainer').style.display = 'block';
            
            // Cambiar el estilo del body para modo cine
            document.body.classList.remove('login-body');
            document.body.style.backgroundColor = 'black';

            const contentFrame = document.getElementById('content');
            contentFrame.src = 'web.html'; // Cargamos el dashboard aquí
            contentFrame.style.display = 'block';
            
            // Pasar el foco al iframe para que funcione el mando en la web
            contentFrame.onload = function() {
                contentFrame.contentWindow.focus();
            };
        }

        // 5. CERRAR SESIÓN
        function logout() {
            localStorage.removeItem('currentUser');
            localStorage.removeItem('serverLoginTime');
            location.reload(); 
        }

        // EVENTOS
        document.addEventListener('DOMContentLoaded', checkSession);
        document.getElementById('loginForm').addEventListener('submit', login);
        document.getElementById('logoutButton').addEventListener('click', logout);
        document.addEventListener('contextmenu', e => e.preventDefault());

    </script>
</body>
</html>